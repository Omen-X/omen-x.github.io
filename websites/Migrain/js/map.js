"use strict";"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),mapboxgl.accessToken="pk.eyJ1Ijoib3NvcmluYSIsImEiOiJjanMyeXVkaXYwNmp4NDNteXE2MHJ2cDg5In0.fo9raJlKCuYINaQnnkzN_A";var map=new mapboxgl.Map({container:"map-inner",style:"mapbox://styles/osorina/cjs4885tz08e01fo4tqqyuilp",center:[83.778536,53.337484],zoom:16,scrollZoom:!1});function flyToStore(e,t){map.flyTo({center:e.geometry.coordinates,zoom:t||17})}function createPopUp(e){var t=document.getElementsByClassName("mapboxgl-popup");t[0]&&t[0].remove();new mapboxgl.Popup({anchor:"bottom",closeOnClick:!1,closeButton:!1}).setLngLat(e.geometry.coordinates).setHTML('<div class="baloon-title">'+e.properties.title+'</div><div class="baloon-subtitle">'+e.properties.address+"</div>"+'<span class="baloon-phone"><a href="tel:'.concat(e.properties.phones,'">').concat(e.properties.phones,"</a></span>")).addTo(map)}function buildLocationList(a){for(var e=0;e<a.features.length;e++){var t=a.features[e],o=t.properties,n=document.querySelector(".map_list").appendChild(document.createElement("div"));n.className="map_li",n.id="map-li-"+e,n.dataset.city=o.city;var i=n.appendChild(document.createElement("a"));i.className="map_linkTo",i.dataPosition=e;var s,r=t.properties.phones.replace(" ","").split(",").map(function(e){return"".concat(e)}).join(","),c=n.appendChild(document.createElement("div"));c.className="map_liDetails",c.innerHTML='<div class="map_liTitle">'.concat(o.title,"</div> <p>").concat(o.address,'</p> <p class="phones"><a href="tel:').concat(r,'">').concat(r,"</a></p>"),o.site&&((s=n.querySelector(".phones").appendChild(document.createElement("a"))).href=o.site,s.target="_blank",s.innerHTML=o.siteFormatted),i.addEventListener("click",function(){var e=a.features[this.dataPosition];flyToStore(e,17),goToMapBox(),createPopUp(e);var t=document.getElementsByClassName("is-active");t[0]&&t[0].classList.remove("is-active"),this.parentNode.classList.add("is-active")})}populateSelectList(a)}map.on("load",function(e){map.addSource("places",{type:"geojson",data:places}).addControl(new MapboxLanguage({defaultLanguage:"ru"})).addControl(new mapboxgl.NavigationControl).addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),buildLocationList(places)}),places.features.forEach(function(a,o){var e=document.createElement("div");e.id="marker-"+o,e.className="marker",new mapboxgl.Marker(e,{offset:[0,-23]}).setLngLat(a.geometry.coordinates).addTo(map),e.addEventListener("click",function(e){flyToStore(a),goToMapBox(),createPopUp(a);var t=document.getElementsByClassName("is-active");e.stopPropagation(),t[0]&&t[0].classList.remove("is-active"),document.getElementById("map-li-"+o).classList.add("is-active")})});var select=document.querySelector(".map_dropdown select"),feturesList=places.features;function populateSelectList(e){var a=feturesList.map(function(e){return e.properties.address}).map(function(e){return e.split(",")[0].replace("г. ","")}).sort(function(e,t){return t<e?1:-1}),t=a.filter(function(e,t){return a.indexOf(e)===t}),o=document.createElement("option");o.value="все",o.innerHTML="Все города",o.selected=!0,select.innerHTML=t.map(function(e){return'<option value="'.concat(e,'">').concat(e,"</option>")}).join(""),select.prepend(o),o.addEventListener("click",function(){console.log("bla")})}function filterList(){var a=this.value;document.querySelectorAll(".map_li").forEach(function(e){var t=e.dataset.city;"все"===a?(map.flyTo({center:[83.778536,53.337484],zoom:16}),e.classList.add("visible"),e.classList.remove("hidden")):a===t?(e.classList.add("visible"),e.classList.remove("hidden")):(e.classList.remove("visible"),e.classList.add("hidden"))});var e=document.getElementsByClassName("visible")[0];visibleItemLink=e.querySelector(".map_linkTo");var t=e.dataset.city;flyToStore(feturesList.filter(function(e){return e.properties.city===t})[0],12);var o=document.getElementsByClassName("is-active");o[0]&&o[0].classList.remove("is-active")}function eventFire(e,t){var a;e.fireEvent?e.fireEvent("on"+t):((a=document.createEvent("Events")).initEvent(t,!0,!1),e.dispatchEvent(a))}function goToMapBox(){var e=$(".header").height();$([document.documentElement,document.body]).animate({scrollTop:$("#map").offset().top-2*e},1e3)}select.addEventListener("change",filterList),window.addEventListener("resize",function(){map.resize()});